<!DOCTYPE html>
<html lang="ko">
<head>
	<link rel="icon" type="image/png" href="/img/favicon.png">
	<meta charset="UTF-8" />
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>회원가입</title>
	<style>
		:root {
			--bg: #f6f6f6;
			--accent: #ff8a00;
			--border: #111;
			--muted: #bfbfbf;
		}

		html, body {
			height: 100%;
			margin: 0;
			font-family: "Helvetica Neue", Arial, "Apple SD Gothic Neo", "Malgun Gothic", sans-serif;
			background: var(--bg);
			color: #111;
		}

		.signup-wrapper {
			min-height: 100vh;
			display: flex;
			flex-direction: column;
			align-items: center;
			justify-content: center;
			padding: 40px 20px;
			box-sizing: border-box;
		}

		#signup-form {
			width: 640px;
			max-width: 92%;
			box-sizing: border-box;
			background: #fff;
			padding: 30px;
			border-radius: 12px;
			box-shadow: 0 2px 8px rgba(0,0,0,0.08);
			position: relative;
		}

		/* 뒤로가기 */
		.back-btn {
			position: absolute;
			top: 16px;
			left: 16px;
			font-size: 14px;
			color: #333;
			background: none;
			border: none;
			cursor: pointer;
			display: flex;
			align-items: center;
			gap: 4px;
			padding: 4px;
		}
		.back-btn svg { width: 16px; height: 16px; }
		.back-btn:hover { color: var(--accent); }
		.back-btn:disabled { cursor: not-allowed; }

		.signup-title {
			font-size: 36px;
			font-weight: 800;
			margin: 10px 0 30px;
			text-align: center;
		}

		#signup-form label {
			display: block;
			margin: 0 0 8px;
			font-weight: 700;
		}

		#signup-form input[type="text"],
		#signup-form input[type="password"],
		#signup-form select {
			width: 100%;
			height: 56px;
			padding: 0 18px;
			margin: 0 0 20px;
			font-size: 16px;
			border-radius: 8px;
			border: 2px solid var(--border);
			box-sizing: border-box;
			outline: none;
			color: #111;
			background: #fff;
		}

		/* 아이디/비밀번호: 화살표 제거 */
		#signup-form input[type="text"],
		#signup-form input[type="password"] {
			appearance: none;
			-webkit-appearance: none;
			-moz-appearance: none;
			background-image: none;
		}
		
		#signup-form input[type="text"]:disabled,
		#signup-form input[type="password"]:disabled {
			background: #DEDEDE;
			cursor: not-allowed;
		}

		/* 셀렉트: 커스텀 화살표 */
		#signup-form select {
			appearance: none;
			-webkit-appearance: none;
			-moz-appearance: none;
			background: #fff url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='%23111'><path d='M2 5l6 6 6-6z'/></svg>") no-repeat;
			background-position: right 16px center;
			background-size: 16px;
			padding-right: 40px;
			cursor: pointer;
		}
		
		#signup-form select:disabled {
			background: #DEDEDE;
			cursor: not-allowed;
		}

		#signup-form input::placeholder { color: var(--muted); }

		.terms-box {
			background: #f9f9f9;
			padding: 16px;
			margin: 0 0 12px;
			border-radius: 8px;
			font-size: 14px;
			line-height: 1.5;
			color: #333;
			max-height: 160px;
			overflow-y: auto;
			border: 1px solid #ccc;
		}

		.agree-row {
			display: flex;
			align-items: center;
			gap: 8px;
			margin: 0 0 20px;
			font-size: 14px;
		}

		#signup-form input[type="submit"] {
			width: 100%;
			height: 56px;
			background: var(--accent);
			color: #fff;
			font-size: 20px;
			font-weight: 700;
			border: none;
			border-radius: 8px;
			cursor: pointer;
		}
		#signup-form input[type="submit"]:active { transform: translateY(1px); }
		
		#signup-form input[type="submit"]:disabled {
			background: var(--accent);
			filter: brightness(85%);
			cursor: not-allowed;
			transform: none;
		}

		.info-note {
			margin-top: 12px;
			font-size: 12px;
			color: #666;
			text-align: center;
		}

		/* 비밀번호 입력칸 + 눈 아이콘 */
		.password-wrapper {
			position: relative;
		}
		.toggle-password {
			position: absolute;
			top: 37%; /* 살짝 위 */
			right: 12px;
			transform: translateY(-50%);
			cursor: pointer;
			background: none;
			border: none;
			padding: 6px;
			line-height: 0;
			color: #666;
		}
		.toggle-password svg {
			width: 20px;
			height: 20px;
			display: block;
		}
	</style>
</head>
<body>
	<div class="signup-wrapper">
		<form id="signup-form" action="/signup" method="POST" accept-charset="UTF-8" autocomplete="off" novalidate>
			<button type="button" id="back" class="back-btn" onclick="window.location.href='login.html'">
				<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
					stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
					<polyline points="15 18 9 12 15 6"></polyline>
				</svg>
				뒤로가기
			</button>

			<h1 class="signup-title">회원가입</h1>

			<div class="terms-box">
				<strong>개인정보 수집 및 이용 동의</strong><br><br>
				본 서비스는 회원가입 및 학사 관리 목적을 위하여 최소한의 개인정보를 수집합니다.<br>
				수집 항목: 이름, 학번, 전화번호, 이메일, 서비스 이용 과정에서 수집되는 접속 로그, 쿠키, 학점, 수강 이력<br>
				이용 목적: 서비스 제공, 학사 관리, 계정 운영<br>
				보유 기간: 회원 탈퇴 시 즉시 파기<br><br>
				※ 동의하지 않으실 경우 회원가입이 제한됩니다.
			</div>

			<div class="agree-row">
				<input type="checkbox" id="agree" name="agree" required />
				<label for="agree">위 내용에 동의합니다.</label>
			</div>

			<input type="text" style="display:none" tabindex="-1" aria-hidden="true" autocomplete="off" />
			<input type="password" style="display:none" tabindex="-1" aria-hidden="true" autocomplete="new-password" />

			<label for="userid">아이디</label>
			<input type="text" id="userid" name="userid" placeholder="아이디 입력" required autocomplete="off" />

			<label for="password">비밀번호</label>
			<div class="password-wrapper">
				<input type="password" id="password" name="password" placeholder="비밀번호 입력" required autocomplete="off" />
				<button type="button" class="toggle-password" id="togglePassword" aria-label="비밀번호 표시 전환">
					<svg id="icon-eye" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none">
						<path d="M1 12s4-7 11-7 11 7 11 7-4 7-11 7S1 12 1 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
						<circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2"/>
					</svg>
					<svg id="icon-eye-off" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" style="display:none;">
						<path d="M3 3l18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
						<path d="M10.58 10.58a3 3 0 104.24 4.24" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
						<path d="M9.88 5.09A10.94 10.94 0 0112 5c7 0 11 7 11 7a19.79 19.79 0 01-4.27 4.73M6.61 6.61A19.79 19.79 0 001 12s4 7 11 7a10.94 10.94 0 003.12-.46" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
					</svg>
				</button>
			</div>

			<label for="track">트랙 선택</label>
			<select id="track" name="track" required>
				<option value="" disabled selected>트랙을 선택하세요</option>
				<option value="선택 안 함">선택 안 함</option>
				<option value="비주얼컴퓨팅트랙">비주얼컴퓨팅트랙</option>
				<option value="AI/DS트랙">AI/DS트랙</option>
				<option value="컴퓨터보안트랙">컴퓨터보안트랙</option>
				<option value="게임트랙">게임트랙</option>
				<option value="AIoT트랙">AIoT트랙</option>
				<option value="소프트웨어심화트랙">소프트웨어심화트랙</option>
			</select>

			<input type="submit" id="submit" value="회원가입" />

			<p class="info-note">아이디와 비밀번호는 ndrims 정보와 같습니다.</p>
		</form>
	</div>

	<script>
		const form = document.getElementById('signup-form');
		// 비밀번호 표시/숨기기
		(function () {
			const pw = document.getElementById('password');
			const btn = document.getElementById('togglePassword');
			const eye = document.getElementById('icon-eye');
			const eyeOff = document.getElementById('icon-eye-off');

			btn.addEventListener('click', function () {
				const isHidden = pw.getAttribute('type') === 'password';
				pw.setAttribute('type', isHidden ? 'text' : 'password');
				eye.style.display = isHidden ? 'none' : 'block';
				eyeOff.style.display = isHidden ? 'block' : 'none';
			});
		})();

		// 폼 검증
		document.getElementById('signup-form').addEventListener('submit', async function (e) {
			e.preventDefault();

			const agree = document.getElementById('agree');
			const user = document.getElementById('userid');
			const pass = document.getElementById('password');
			const track = document.getElementById('track');
			const back = document.getElementById('back');
			const submit = document.getElementById('submit');

			if (!agree.checked) {
				alert('개인정보 수집 및 이용에 동의해 주세요.');
				return;
			}
			if (!user.value.trim() || !pass.value.trim()) {
				alert('아이디와 비밀번호를 모두 입력해 주세요.');
				return;
			}
			if (!track.value) {
				alert('트랙을 선택해 주세요.');
				return;
			}
			
			try {
				const formData = new FormData(form);
				const data = {
					username: formData.get("userid"),
					password: formData.get("password"),
					track: track.value
				};
				
				agree.disabled = true;
				user.disabled = true;
				pass.disabled = true;
				track.disabled = true;
				back.disabled = true;
				submit.disabled = true;
			
				// 개발/테스트용: URL에 ?simulateSlow=1 붙이면 의도적 지연(6초)을 넣어 테스트 가능
				const simulateSlow = window.location.search.includes("simulateSlow=1");
				if (simulateSlow) {
					await new Promise((r) => setTimeout(r, 6000));
				}
	
				const response = await fetch("https://nexcode.kr:16003/signup", {
					method: "POST",
					headers: { "Content-Type": "application/json" },
					body: JSON.stringify(data)
				});
	
				const result = await response.json();
	
				if (result.status === "success") {
					// 학생 데이터 저장 및 이동
					if (result.data && result.data[0]) {
						sessionStorage.setItem("studentData", JSON.stringify(result.data[0]));
					}
					window.location.href = "/";
				} else {
					alert("로그인 실패: " + (result.message || "아이디/비밀번호 확인"));
				}
			} catch (err) {
				console.error("오류 발생:", err);
				alert("서버와 연결할 수 없습니다.");
			} finally {
				agree.disabled = false;
				user.disabled = false;
				pass.disabled = false;
				track.disabled = false;
				back.disabled = false;
				submit.disabled = false;
				
				// 타이머 취소 (아직 안 찍혔다면 방지)
				clearTimeout(timerId);
	
				// 만약 안내문구가 표시되어 있으면 최소한 1.5초 더 보여준 뒤 제거 (사용자 눈에 보이도록)
				if (noticeBox) {
					setTimeout(() => {
						if (noticeBox && noticeBox.parentNode) noticeBox.parentNode.removeChild(noticeBox);
					}, 1500);
				}
			}
		});
	</script>
</body>
</html>
